---
import { type CollectionEntry, getCollection } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';
import { render } from 'astro:content';

const posts = await getCollection("blog");

// Extract unique tags
const tagsSet = new Set<string>();
posts.forEach(post => {
    post.data.tags?.forEach(tag => tagsSet.add(tag));
});
const tags = Array.from(tagsSet).sort();

// Generate dynamic paths for each tag
export function getStaticPaths() {
    return tags.map(tag => ({
        params: { tag },
    }));
}

// Get the current tag from the URL
const { tag } = Astro.params;

// Filter posts with the selected tag
const filteredPosts = posts.filter(post => post.data.tags?.includes(tag));
---

<BlogPost {...post.data}>
	<div class="blog-content">
		<Content />
	</div>
</BlogPost>
